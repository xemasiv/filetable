var _createClass=function(){function r(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,n,t){return n&&r(e.prototype,n),t&&r(e,t),e}}();function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var sha3_256=window.sha3_256,EventEmitter3=window.EventEmitter3,localforage=window.localforage,async=window.async;console.log("sha3_256:",sha3_256),console.log("EventEmitter3:",EventEmitter3),console.log("localforage:",localforage),console.log("async:",async);var FileTable=function(){function n(){_classCallCheck(this,n),this._files=[],this._chunks={};var r=new EventEmitter3;this.on=function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];r.on.apply(r,n)},this.emit=function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];r.emit.apply(r,n)};var e=async.queue(function(e,n){e(n)});this._queue=e}return _createClass(n,[{key:"bind",value:function(e){var r=this,a=this;$(e).change(function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];r.queueFile.apply(a,n)})}},{key:"queueFile",value:function(e){var n=this,t=this._queue,r=e.target.files;Object.keys(r).map(function(e){t.push(n.processFile(r[e]),function(){n.emit("new_file")})})}},{key:"processFile",value:function(e){var f=this;return function(o){var i=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,l=4194304,c=Math.ceil(e.size/l),s=0,u=sha3_256.create();f.emit("bufferStart");!function t(r){var e=new FileReader;e.onload=function(e){if(console.log(e.target.result),f.emit("bufferAppend",e.target.result),u.update(e.target.result),++s<c)t(r);else{var n=btoa(u.hex()).concat(".",function(e,n){if(n||(n={}),!e)return"";var t=(/[^./\\]*$/.exec(e)||[""])[0];return n.preserveCase?t:t.toLowerCase()}(r.name));console.log(n),f.emit("bufferEnd"),o()}},e.onerror=function(){console.log("fileReader error.")};var n=s*l,a=n+l>=r.size?r.size:n+l;e.readAsArrayBuffer(i.call(r,n,a))}(e)}}},{key:"addFile",value:function(){return new Promise(function(e,n){})}},{key:"getFiles",value:function(){return this._files}},{key:"getFileChunk",value:function(e,n){return this._chunks[e][n]}}]),n}();window.FileTable=FileTable;